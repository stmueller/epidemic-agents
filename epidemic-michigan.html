<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Anne Linja and Shane Mueller" />

<meta name="date" content="2020-05-05" />

<title>Modeling disease spread with a geographic agent-based model</title>

<script src="support_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="support_files/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
<script src="support_files/bootstrap-3.3.7/js/bootstrap.min.js"></script>
<script src="support_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<script src="support_files/navigation-1.1/tabsets.js"></script>
<script src="support_files/navigation-1.1/codefolding.js"></script>
<link href="support_files/magnific-popup-1.1.0/magnific-popup.css" rel="stylesheet" />
<script src="support_files/magnific-popup-1.1.0/jquery.magnific-popup.min.js"></script>
<link href="support_files/readthedown-0.1/readthedown.css" rel="stylesheet" />
<script src="support_files/readthedown-0.1/readthedown.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>


</head>

<body>


<div id="content" data-toggle="wy-nav-shift">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("text-table-of-contents");
});
</script>

<!-- code folding -->

<nav id="nav-top" role="navigation" aria-label="top navigation">
    <a role="button" href="#" data-toggle="wy-nav-top"><span class="glyphicon glyphicon-menu-hamburger"></span></a>
</nav>


<div id="header">
<h1 class="title">Modeling disease spread with a geographic agent-based model</h1>
</div>


<div id="sidebar">
    <h2><a href="#content">Modeling disease spread with a geographic agent-based model</a></h2>
    <div id="table-of-contents">
      <ul>
      <li><a href="#the-agent">The agent</a></li>
      <li><a href="#create-transition-matrix.">Create transition matrix.</a></li>
      <li><a href="#modeling-michigan-county-data.">Modeling michigan county data.</a></li>
      <li><a href="#plot-final-state">Plot final state</a></li>
      <li><a href="#progress-in-state-vs.-up-only.-growth-for-up-and-for-entire-state.">Progress in state vs. UP only. Growth for UP and for entire state.</a></li>
      </ul>
    </div>
    
    <div id="postamble" data-toggle="wy-nav-shift" class="status">
              <p class="author"><span class="glyphicon glyphicon-user"></span> Anne Linja and Shane Mueller</p>
                  <p class="date"><span class="glyphicon glyphicon-calendar"></span> May 5, 2020</p>
        </div>
</div>

<div id="main">
<p>This model is based on the model/simulation found <a href="epidemic-model-base.html">found here</a>. In this simulation, we generate a network model based roughly on the geographic layout of michigan, in order to explore how geography may impact disease spread.</p>
<div id="the-agent" class="section level2">
<h2>The agent</h2>
<p>The biological state has a few specific cases:</p>
<ol style="list-style-type: decimal">
<li>Unexposed</li>
<li>Asymptomatic but infected/contagious</li>
<li>Symptomatic and contagious</li>
<li>Symptomatic and not contagious</li>
<li>Post-COVID Immune</li>
<li>Naturally immune (will not contract)</li>
<li>Death</li>
</ol>
<p>We could identify several others, but this might be fine. So, we can define the agent according to just two numbers. We might assume that initially, most people are in bio-state 1, but some would be in state 6 already, which is essentially the same as state 5.</p>
<p>We will just define these as a named list.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(sna)</a></code></pre></div>
<pre><code>## Loading required package: statnet.common</code></pre>
<pre><code>## 
## Attaching package: &#39;statnet.common&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     order</code></pre>
<pre><code>## Loading required package: network</code></pre>
<pre><code>## network: Classes for Relational Data
## Version 1.16.0 created on 2019-11-30.
## copyright (c) 2005, Carter T. Butts, University of California-Irvine
##                     Mark S. Handcock, University of California -- Los Angeles
##                     David R. Hunter, Penn State University
##                     Martina Morris, University of Washington
##                     Skye Bender-deMoll, University of Washington
##  For citation information, type citation(&quot;network&quot;).
##  Type help(&quot;network-package&quot;) to get started.</code></pre>
<pre><code>## sna: Tools for Social Network Analysis
## Version 2.5 created on 2019-12-09.
## copyright (c) 2005, Carter T. Butts, University of California-Irvine
##  For citation information, type citation(&quot;sna&quot;).
##  Type help(package=&quot;sna&quot;) to get started.</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">library</span>(reshape2)</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">library</span>(igraph)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;igraph&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:sna&#39;:
## 
##     betweenness, bonpow, closeness, components, degree, dyad.census,
##     evcent, hierarchy, is.connected, neighborhood, triad.census</code></pre>
<pre><code>## The following objects are masked from &#39;package:network&#39;:
## 
##     %c%, %s%, add.edges, add.vertices, delete.edges, delete.vertices,
##     get.edge.attribute, get.edges, get.vertex.attribute, is.bipartite,
##     is.directed, list.edge.attributes, list.vertex.attributes,
##     set.edge.attribute, set.vertex.attribute</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     as_data_frame, groups, union</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     decompose, spectrum</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     union</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co">#library(animation)</span></a>
<a class="sourceLine" id="cb19-2" title="2">STATES &lt;&lt;-<span class="st"> </span><span class="dv">7</span></a>
<a class="sourceLine" id="cb19-3" title="3"></a>
<a class="sourceLine" id="cb19-4" title="4">STATENAMES &lt;&lt;-<span class="st">  </span><span class="kw">c</span>(<span class="st">&quot;Unexposed&quot;</span>,</a>
<a class="sourceLine" id="cb19-5" title="5">                  <span class="st">&quot;Asymptomatic &amp; contagious&quot;</span>,</a>
<a class="sourceLine" id="cb19-6" title="6"><span class="st">&quot;Symptomatic and contagious&quot;</span>,</a>
<a class="sourceLine" id="cb19-7" title="7"><span class="st">&quot;Symptomatic and not contagious&quot;</span>,</a>
<a class="sourceLine" id="cb19-8" title="8"><span class="st">&quot;Post-COVID immune&quot;</span>,</a>
<a class="sourceLine" id="cb19-9" title="9"><span class="st">&quot;Naturally immune&quot;</span>,</a>
<a class="sourceLine" id="cb19-10" title="10"><span class="st">&quot;Death&quot;</span>)</a>
<a class="sourceLine" id="cb19-11" title="11"></a>
<a class="sourceLine" id="cb19-12" title="12"></a>
<a class="sourceLine" id="cb19-13" title="13">STATELABELS &lt;&lt;-<span class="st">  </span><span class="kw">c</span>(<span class="st">&quot;Unexposed&quot;</span>,<span class="st">&quot;Asymptomatic</span><span class="ch">\n</span><span class="st"> &amp; contagious&quot;</span>,</a>
<a class="sourceLine" id="cb19-14" title="14"><span class="st">&quot;Symptomatic </span><span class="ch">\n</span><span class="st">&amp; contagious&quot;</span>,</a>
<a class="sourceLine" id="cb19-15" title="15"><span class="st">&quot;Symptomatic </span><span class="ch">\n</span><span class="st">&amp; not contagious&quot;</span>,</a>
<a class="sourceLine" id="cb19-16" title="16"><span class="st">&quot;Post-COVID immune&quot;</span>,</a>
<a class="sourceLine" id="cb19-17" title="17"><span class="st">&quot;Naturally immune&quot;</span>,</a>
<a class="sourceLine" id="cb19-18" title="18"><span class="st">&quot;Death&quot;</span>)</a>
<a class="sourceLine" id="cb19-19" title="19"></a>
<a class="sourceLine" id="cb19-20" title="20">makeAgent &lt;-<span class="st"> </span><span class="cf">function</span>(psychstate,biostate,<span class="dt">age=</span><span class="dv">30</span>)</a>
<a class="sourceLine" id="cb19-21" title="21">{</a>
<a class="sourceLine" id="cb19-22" title="22">  </a>
<a class="sourceLine" id="cb19-23" title="23">  <span class="kw">return</span> (<span class="kw">list</span>(<span class="dt">psychstate=</span>psychstate,</a>
<a class="sourceLine" id="cb19-24" title="24">               <span class="dt">biostate=</span>biostate,</a>
<a class="sourceLine" id="cb19-25" title="25">               <span class="dt">age=</span>age,</a>
<a class="sourceLine" id="cb19-26" title="26">               <span class="dt">nextbiostate=</span><span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb19-27" title="27">               <span class="dt">biostatecountdown=</span><span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb19-28" title="28">}</a>
<a class="sourceLine" id="cb19-29" title="29"><span class="kw">print</span>(<span class="kw">makeAgent</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a></code></pre></div>
<pre><code>## $psychstate
## [1] 1
## 
## $biostate
## [1] 2
## 
## $age
## [1] 30
## 
## $nextbiostate
## [1] NA
## 
## $biostatecountdown
## [1] NA</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">updateAgent&lt;-<span class="st"> </span><span class="cf">function</span>(agent)</a>
<a class="sourceLine" id="cb21-2" title="2">{</a>
<a class="sourceLine" id="cb21-3" title="3">   agent<span class="op">$</span>biostatecountdown &lt;-<span class="st"> </span>agent<span class="op">$</span>biostatecountdown <span class="dv">-1</span></a>
<a class="sourceLine" id="cb21-4" title="4">  <span class="cf">if</span>(agent<span class="op">$</span>biostatecountdown <span class="op">&lt;=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb21-5" title="5">  {</a>
<a class="sourceLine" id="cb21-6" title="6">    agent<span class="op">$</span>biostate &lt;-<span class="st"> </span>agent<span class="op">$</span>nextbiostate</a>
<a class="sourceLine" id="cb21-7" title="7">    agent<span class="op">$</span>biostatecountdown &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb21-8" title="8">  }</a>
<a class="sourceLine" id="cb21-9" title="9">   <span class="kw">return</span>(agent)</a>
<a class="sourceLine" id="cb21-10" title="10">}</a></code></pre></div>
</div>
<div id="create-transition-matrix." class="section level2">
<h2>Create transition matrix.</h2>
<p>If on each timestep we could move between states probabilistically, this would be a markov process. We could represent this by a simple transition network. If we represented the possible transitions in a network, that would simplify the logic above. But we need more like a task network because the time taken to transition matters. To keep it simple, Let’s make all timing distributions uniform with a min and max parameter for time in each state. We can program two pathways through the stages, with a couple branch points (death vs recovery; the possibility of recovering after acquiring with no symptoms). The progression of the disease is completely specified by the data, and a generic update function will automatically progress the agent each day.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co"># * 1. Unexposed</span></a>
<a class="sourceLine" id="cb22-2" title="2"><span class="co"># * 2. Asymptomatic but infected/contagious</span></a>
<a class="sourceLine" id="cb22-3" title="3"><span class="co"># * 3. Symptomatic and contagious</span></a>
<a class="sourceLine" id="cb22-4" title="4"><span class="co"># * 4. Symptomatic and not contagious</span></a>
<a class="sourceLine" id="cb22-5" title="5"><span class="co"># * 5. Post-COVID Immune</span></a>
<a class="sourceLine" id="cb22-6" title="6"><span class="co"># * 6. Naturally immune (will not contract)</span></a>
<a class="sourceLine" id="cb22-7" title="7"><span class="co"># * 7. Death</span></a>
<a class="sourceLine" id="cb22-8" title="8"></a>
<a class="sourceLine" id="cb22-9" title="9"></a>
<a class="sourceLine" id="cb22-10" title="10">bioTransition &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">0</span>,STATES,STATES)</a>
<a class="sourceLine" id="cb22-11" title="11">bioMin &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>,STATES)      <span class="co">#state time minimum</span></a>
<a class="sourceLine" id="cb22-12" title="12">bioMax &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span>,STATES)      <span class="co">#state time maximum</span></a>
<a class="sourceLine" id="cb22-13" title="13"></a>
<a class="sourceLine" id="cb22-14" title="14"></a>
<a class="sourceLine" id="cb22-15" title="15"></a>
<a class="sourceLine" id="cb22-16" title="16">bioMin[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">3</span>            <span class="co">#infected but asymptomatic for 3 to 10 days</span></a>
<a class="sourceLine" id="cb22-17" title="17">bioMax[<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="dv">10</span>          </a>
<a class="sourceLine" id="cb22-18" title="18">bioTransition[<span class="dv">2</span>,<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="fl">.5</span>  <span class="co">#transition to infected with symptoms</span></a>
<a class="sourceLine" id="cb22-19" title="19">bioTransition[<span class="dv">2</span>,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="fl">.5</span>  <span class="co">#transition to no longer contagious/cured</span></a>
<a class="sourceLine" id="cb22-20" title="20"></a>
<a class="sourceLine" id="cb22-21" title="21"></a>
<a class="sourceLine" id="cb22-22" title="22">bioMin[<span class="dv">3</span>] &lt;-<span class="st">    </span><span class="dv">3</span>             <span class="co">#symptoms + contagion</span></a>
<a class="sourceLine" id="cb22-23" title="23">bioMax[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="dv">8</span>                <span class="co">#symptoms + contagion max</span></a>
<a class="sourceLine" id="cb22-24" title="24">bioTransition[<span class="dv">3</span>,<span class="dv">4</span>] &lt;-<span class="st">  </span><span class="fl">.95</span>    <span class="co">#transitioon to no longer contagious</span></a>
<a class="sourceLine" id="cb22-25" title="25">bioTransition[<span class="dv">3</span>,<span class="dv">7</span>] &lt;-<span class="st">  </span><span class="fl">.05</span>    <span class="co">#transitioon to death state </span></a>
<a class="sourceLine" id="cb22-26" title="26"></a>
<a class="sourceLine" id="cb22-27" title="27"></a>
<a class="sourceLine" id="cb22-28" title="28">bioMin[<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="dv">1</span>          <span class="co">#symptoms bot no longer contagiious</span></a>
<a class="sourceLine" id="cb22-29" title="29">bioMax[<span class="dv">4</span>] &lt;-<span class="st"> </span><span class="dv">7</span></a>
<a class="sourceLine" id="cb22-30" title="30">bioTransition[<span class="dv">4</span>,<span class="dv">5</span>] &lt;-<span class="st"> </span><span class="dv">1</span>  <span class="co">#Transition to &#39;immune&#39; cured state.</span></a>
<a class="sourceLine" id="cb22-31" title="31"></a>
<a class="sourceLine" id="cb22-32" title="32"></a>
<a class="sourceLine" id="cb22-33" title="33"></a>
<a class="sourceLine" id="cb22-34" title="34"></a>
<a class="sourceLine" id="cb22-35" title="35">setAgentState&lt;-<span class="st"> </span><span class="cf">function</span>(agent, biostate)</a>
<a class="sourceLine" id="cb22-36" title="36">{</a>
<a class="sourceLine" id="cb22-37" title="37">  agent<span class="op">$</span>biostate &lt;-<span class="st"> </span>biostate</a>
<a class="sourceLine" id="cb22-38" title="38">  <span class="cf">if</span>(<span class="kw">sum</span>(bioTransition[biostate,])<span class="op">&gt;</span><span class="dv">0</span>) <span class="co"># this state transitions to something else.</span></a>
<a class="sourceLine" id="cb22-39" title="39">  {</a>
<a class="sourceLine" id="cb22-40" title="40">    <span class="co">##which state do we go to?</span></a>
<a class="sourceLine" id="cb22-41" title="41">     agent<span class="op">$</span>biostatecountdown &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dt">x=</span><span class="kw">seq</span>(bioMin[biostate],bioMax[biostate]),<span class="dv">1</span>) <span class="co">#how long will we state in this state?</span></a>
<a class="sourceLine" id="cb22-42" title="42">     agent<span class="op">$</span>nextbiostate &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>STATES, <span class="dt">prob=</span>bioTransition[agent<span class="op">$</span>biostate,],<span class="dt">size=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-43" title="43">     </a>
<a class="sourceLine" id="cb22-44" title="44">  } <span class="cf">else</span>{</a>
<a class="sourceLine" id="cb22-45" title="45">   agent<span class="op">$</span>biostatecountdown &lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb22-46" title="46">   agent<span class="op">$</span>nextbiostate &lt;-<span class="st"> </span><span class="ot">NA</span>   <span class="co">##just so we can tell if the agent is finished.</span></a>
<a class="sourceLine" id="cb22-47" title="47">  }</a>
<a class="sourceLine" id="cb22-48" title="48">  <span class="kw">return</span>(agent) </a>
<a class="sourceLine" id="cb22-49" title="49">}</a>
<a class="sourceLine" id="cb22-50" title="50"></a>
<a class="sourceLine" id="cb22-51" title="51">transitionAgent&lt;-<span class="st"> </span><span class="cf">function</span>(agent)</a>
<a class="sourceLine" id="cb22-52" title="52">{</a>
<a class="sourceLine" id="cb22-53" title="53">   <span class="kw">return</span>(<span class="kw">setAgentState</span>(agent,agent<span class="op">$</span>nextbiostate))</a>
<a class="sourceLine" id="cb22-54" title="54">}</a>
<a class="sourceLine" id="cb22-55" title="55"></a>
<a class="sourceLine" id="cb22-56" title="56">updateAgent&lt;-<span class="st"> </span><span class="cf">function</span>(agent)</a>
<a class="sourceLine" id="cb22-57" title="57">{</a>
<a class="sourceLine" id="cb22-58" title="58">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.na</span>(agent<span class="op">$</span>biostatecountdown))</a>
<a class="sourceLine" id="cb22-59" title="59">  {</a>
<a class="sourceLine" id="cb22-60" title="60">   agent<span class="op">$</span>biostatecountdown &lt;-<span class="st"> </span>agent<span class="op">$</span>biostatecountdown <span class="dv">-1</span></a>
<a class="sourceLine" id="cb22-61" title="61">    <span class="cf">if</span>(agent<span class="op">$</span>biostatecountdown <span class="op">&lt;=</span><span class="dv">0</span>)  <span class="co">##new state</span></a>
<a class="sourceLine" id="cb22-62" title="62">    {</a>
<a class="sourceLine" id="cb22-63" title="63">       agent &lt;-<span class="st"> </span><span class="kw">transitionAgent</span>(agent)</a>
<a class="sourceLine" id="cb22-64" title="64"></a>
<a class="sourceLine" id="cb22-65" title="65">    }</a>
<a class="sourceLine" id="cb22-66" title="66">  }</a>
<a class="sourceLine" id="cb22-67" title="67">   <span class="kw">return</span>(agent)</a>
<a class="sourceLine" id="cb22-68" title="68">}</a></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="kw">par</span>(<span class="dt">xpd=</span><span class="ot">NA</span>,<span class="dt">mar=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb23-2" title="2"><span class="kw">gplot</span>(bioTransition,<span class="dt">label=</span>STATELABELS)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-3-1.png" width="768" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">mygplot &lt;-<span class="st"> </span><span class="cf">function</span>(coord, network,states,<span class="dt">main=</span><span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb24-2" title="2">{</a>
<a class="sourceLine" id="cb24-3" title="3">  <span class="cf">if</span>(<span class="kw">is.null</span>(coord))</a>
<a class="sourceLine" id="cb24-4" title="4">  {</a>
<a class="sourceLine" id="cb24-5" title="5">    coord  &lt;-<span class="st"> </span><span class="kw">gplot.layout.fruchtermanreingold</span>(network,<span class="dt">layout.par=</span><span class="kw">list</span>(<span class="dt">niter=</span><span class="dv">500</span>))</a>
<a class="sourceLine" id="cb24-6" title="6">  }</a>
<a class="sourceLine" id="cb24-7" title="7">  </a>
<a class="sourceLine" id="cb24-8" title="8">  newmin &lt;-<span class="st"> </span><span class="kw">mean</span>(coord[,<span class="dv">2</span>]) <span class="op">-</span><span class="st">  </span>(<span class="op">-</span><span class="kw">min</span>(coord[,<span class="dv">2</span>]) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(coord[,<span class="dv">2</span>])) <span class="op">*</span><span class="st"> </span><span class="fl">1.4</span></a>
<a class="sourceLine" id="cb24-9" title="9">   palette=<span class="kw">c</span>(<span class="st">&quot;white&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;darkgreen&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb24-10" title="10">   <span class="kw">plot</span>(coord,<span class="dt">col=</span><span class="st">&quot;black&quot;</span>,<span class="dt">bty=</span><span class="st">&quot;n&quot;</span>,<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">cex=</span><span class="fl">2.7</span>,<span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span>,<span class="dt">yaxt=</span><span class="st">&quot;n&quot;</span>,<span class="dt">main=</span>main,<span class="dt">xlab=</span><span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb24-11" title="11">          <span class="dt">ylab=</span><span class="st">&quot;&quot;</span>,<span class="dt">axes=</span>F,</a>
<a class="sourceLine" id="cb24-12" title="12">        <span class="dt">ylim=</span><span class="kw">c</span>(newmin,<span class="kw">max</span>(coord[,<span class="dv">2</span>])),<span class="dt">type=</span><span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb24-13" title="13">   </a>
<a class="sourceLine" id="cb24-14" title="14">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(network))</a>
<a class="sourceLine" id="cb24-15" title="15">     <span class="kw">segments</span>(coord[i,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb24-16" title="16">            coord[i,<span class="dv">2</span>],</a>
<a class="sourceLine" id="cb24-17" title="17">            coord[network[i,]<span class="op">==</span><span class="dv">1</span>,<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb24-18" title="18">            coord[network[i,]<span class="op">==</span><span class="dv">1</span>,<span class="dv">2</span>],<span class="dt">col=</span><span class="st">&quot;grey40&quot;</span>)</a>
<a class="sourceLine" id="cb24-19" title="19"></a>
<a class="sourceLine" id="cb24-20" title="20">       <span class="kw">points</span>(coord,<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">cex=</span><span class="fl">2.3</span>,<span class="dt">col=</span> palette[states])</a>
<a class="sourceLine" id="cb24-21" title="21">              </a>
<a class="sourceLine" id="cb24-22" title="22">       <span class="kw">points</span>(coord,<span class="dt">pch=</span><span class="dv">1</span>,<span class="dt">cex=</span><span class="fl">2.3</span>,<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb24-23" title="23">      <span class="kw">legend</span>(<span class="kw">mean</span>(coord[,<span class="dv">1</span>]),<span class="kw">min</span>(coord[,<span class="dv">2</span>]),<span class="dt">bty=</span><span class="st">&#39;n&#39;</span>,<span class="dt">y.intersp=</span>.<span class="dv">7</span>,<span class="dt">cex=</span>.<span class="dv">8</span>,</a>
<a class="sourceLine" id="cb24-24" title="24">              STATENAMES, <span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">col=</span>palette)</a>
<a class="sourceLine" id="cb24-25" title="25">              </a>
<a class="sourceLine" id="cb24-26" title="26">      <span class="kw">return</span> (coord)</a>
<a class="sourceLine" id="cb24-27" title="27">  }</a></code></pre></div>
</div>
<div id="modeling-michigan-county-data." class="section level2">
<h2>Modeling michigan county data.</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="co">#library(readxl)</span></a>
<a class="sourceLine" id="cb25-2" title="2">counties   &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;MI_Counties.csv&quot;</span>)</a>
<a class="sourceLine" id="cb25-3" title="3">numcounties &lt;-<span class="st"> </span><span class="kw">nrow</span>(counties) <span class="co">##83</span></a>
<a class="sourceLine" id="cb25-4" title="4"></a>
<a class="sourceLine" id="cb25-5" title="5"><span class="kw">plot</span>(counties<span class="op">$</span>LON,counties<span class="op">$</span>LAT,<span class="dt">pch=</span><span class="dv">16</span>,<span class="dt">cex=</span><span class="dv">3</span>)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-5-1.png" width="1728" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">countydist &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">dist</span>(<span class="kw">cbind</span>(counties<span class="op">$</span>LON,counties<span class="op">$</span>LAT<span class="op">*</span><span class="dv">2</span>)))</a>
<a class="sourceLine" id="cb26-2" title="2">ranks &lt;-<span class="st"> </span><span class="kw">apply</span>(countydist,<span class="dv">1</span>,rank)</a>
<a class="sourceLine" id="cb26-3" title="3">nearby &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">+</span>(ranks<span class="op">&lt;</span><span class="dv">7</span> <span class="op">|</span><span class="st"> </span>countydist<span class="op">&lt;</span>.<span class="dv">85</span> )</a>
<a class="sourceLine" id="cb26-4" title="4"></a>
<a class="sourceLine" id="cb26-5" title="5"></a>
<a class="sourceLine" id="cb26-6" title="6"></a>
<a class="sourceLine" id="cb26-7" title="7">coords &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">LON=</span>counties<span class="op">$</span>LON,<span class="dt">LAT=</span>counties<span class="op">$</span>LAT<span class="op">*</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb26-8" title="8">coords<span class="op">$</span>UP &lt;-<span class="st"> </span>coords<span class="op">$</span>LAT<span class="op">&gt;</span><span class="fl">91.05</span></a>
<a class="sourceLine" id="cb26-9" title="9"></a>
<a class="sourceLine" id="cb26-10" title="10"><span class="kw">mygplot</span>(<span class="dt">coord=</span>coords[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>],nearby,<span class="dt">states=</span>coords<span class="op">$</span>UP<span class="op">+</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-5-2.png" width="1728" /></p>
<pre><code>##         LON     LAT
## 1  -83.5938 89.3708
## 2  -86.6018 92.8198
## 3  -85.8884 85.1826
## 4  -83.6277 90.0696
## 5  -85.1377 90.0006
## 6  -83.8948 88.1312
## 7  -88.3652 93.3252
## 8  -85.3090 85.1900
## 9  -83.9921 87.4144
## 10 -86.0158 89.2790
## 11 -86.4123 83.9092
## 12 -85.0590 83.8322
## 13 -85.0055 84.4932
## 14 -85.9936 83.8306
## 15 -85.1283 90.6040
## 16 -84.4999 90.8936
## 17 -84.5921 92.6062
## 18 -84.8478 87.9758
## 19 -84.6015 85.8872
## 20 -84.6103 89.3672
## 21 -86.9244 91.8394
## 22 -87.8704 92.0182
## 23 -84.8384 85.1922
## 24 -84.8905 91.0410
## 25 -83.7067 86.0434
## 26 -84.3882 87.9812
## 27 -89.6944 92.8178
## 28 -85.5590 89.3418
## 29 -84.6048 86.5854
## 30 -84.5930 83.7756
## 31 -88.6918 93.7868
## 32 -83.0193 87.6666
## 33 -84.3736 85.1942
## 34 -85.0746 85.8902
## 35 -83.6360 88.7118
## 36 -88.5305 92.4174
## 37 -84.8467 87.2812
## 38 -84.4233 84.4970
## 39 -85.5311 84.4908
## 40 -85.0902 89.3692
## 41 -85.5492 86.0644
## 42 -88.4287 95.2208
## 43 -85.8017 87.9800
## 44 -83.2218 86.1802
## 45 -85.8123 89.8732
## 46 -84.0664 83.7902
## 47 -83.9115 85.2060
## 48 -85.5443 92.9414
## 49 -85.0921 92.1624
## 50 -82.9322 85.3912
## 51 -86.0571 88.6664
## 52 -87.6415 92.8628
## 53 -86.2497 87.9908
## 54 -85.3245 87.2818
## 55 -87.5573 91.1584
## 56 -84.3879 87.2936
## 57 -85.0947 88.6746
## 58 -83.5373 83.8584
## 59 -85.1524 86.6220
## 60 -84.1273 90.0552
## 61 -86.1481 86.5824
## 62 -85.8009 87.1084
## 63 -83.3855 85.3208
## 64 -86.2673 87.2814
## 65 -84.1266 88.6698
## 66 -89.3150 93.3288
## 67 -85.3252 87.9798
## 68 -84.1297 89.3634
## 69 -84.5988 90.0428
## 70 -85.9939 85.9202
## 71 -83.9173 90.6804
## 72 -84.6116 88.6712
## 73 -84.0532 86.6700
## 74 -82.8201 86.8470
## 75 -86.1995 92.3934
## 76 -84.1467 85.9074
## 77 -82.6823 85.8850
## 78 -85.5278 83.8290
## 79 -83.4168 86.9282
## 80 -86.0189 84.5026
## 81 -83.8384 84.5068
## 82 -83.2865 84.5680
## 83 -85.5785 88.6768</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="co">#matrix(NA,nrow=nrow(countydist),ncol=nrow(countydist))</span></a>
<a class="sourceLine" id="cb28-2" title="2"></a>
<a class="sourceLine" id="cb28-3" title="3">numAgents &lt;-<span class="st"> </span><span class="dv">2500</span> </a>
<a class="sourceLine" id="cb28-4" title="4">simPop &lt;-<span class="st"> </span><span class="kw">ceiling</span>(counties<span class="op">$</span>Population<span class="op">/</span><span class="kw">sum</span>(counties<span class="op">$</span>Population) <span class="op">*</span><span class="st"> </span>numAgents) </a>
<a class="sourceLine" id="cb28-5" title="5">numAgents &lt;-<span class="st"> </span><span class="kw">sum</span>(simPop)</a>
<a class="sourceLine" id="cb28-6" title="6">whichcounty &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>numcounties,<span class="dt">times=</span>simPop) </a>
<a class="sourceLine" id="cb28-7" title="7">inUP &lt;-<span class="st"> </span>coords<span class="op">$</span>UP[whichcounty]</a>
<a class="sourceLine" id="cb28-8" title="8"></a>
<a class="sourceLine" id="cb28-9" title="9"></a>
<a class="sourceLine" id="cb28-10" title="10"><span class="co">##Create the network</span></a>
<a class="sourceLine" id="cb28-11" title="11"></a>
<a class="sourceLine" id="cb28-12" title="12">withincounty &lt;-<span class="st"> </span><span class="kw">outer</span>(whichcounty,whichcounty,<span class="st">&quot;==&quot;</span>) </a>
<a class="sourceLine" id="cb28-13" title="13">betweencounties &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,numAgents, numAgents) </a>
<a class="sourceLine" id="cb28-14" title="14"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numAgents)</a>
<a class="sourceLine" id="cb28-15" title="15">{ </a>
<a class="sourceLine" id="cb28-16" title="16">  <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numAgents)</a>
<a class="sourceLine" id="cb28-17" title="17">   {</a>
<a class="sourceLine" id="cb28-18" title="18">    betweencounties[i,j] &lt;-<span class="kw">runif</span>(<span class="dv">1</span>) <span class="op">&lt;</span><span class="st"> </span><span class="fl">.5</span><span class="op">*</span><span class="st"> </span>nearby[whichcounty[i],whichcounty[j]]</a>
<a class="sourceLine" id="cb28-19" title="19">   }</a>
<a class="sourceLine" id="cb28-20" title="20">}</a>
<a class="sourceLine" id="cb28-21" title="21"><span class="co">#gplot(withincounty+betweencounties)</span></a>
<a class="sourceLine" id="cb28-22" title="22">socialnetwork &lt;-<span class="st"> </span>(withincounty <span class="op">+</span><span class="st"> </span>betweencounties) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="co">#this is where we make the whole network. either T or 1, or F/2.</span></a>
<a class="sourceLine" id="cb28-23" title="23">coords2 &lt;-<span class="st"> </span><span class="kw">cbind</span>(coords[whichcounty,<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(numAgents)<span class="op">*</span>.<span class="dv">15</span>,</a>
<a class="sourceLine" id="cb28-24" title="24">                    coords[whichcounty,<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(numAgents)<span class="op">*</span>.<span class="dv">15</span>) </a>
<a class="sourceLine" id="cb28-25" title="25"></a>
<a class="sourceLine" id="cb28-26" title="26"></a>
<a class="sourceLine" id="cb28-27" title="27"><span class="cf">if</span>(<span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb28-28" title="28">{</a>
<a class="sourceLine" id="cb28-29" title="29">    cc &lt;-<span class="kw">mygplot</span>(<span class="dt">coord=</span>coords2,socialnetwork,<span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">nrow</span>(socialnetwork)),<span class="dt">main=</span><span class="st">&quot;Initial state&quot;</span>)</a>
<a class="sourceLine" id="cb28-30" title="30"></a>
<a class="sourceLine" id="cb28-31" title="31">}</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-5-3.png" width="1728" /></p>
<p>##Now, make the social network combine within and between county data. Simulate disease spread.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="co">#mygplot(coord=coords2,socialnetwork,</span></a>
<a class="sourceLine" id="cb29-2" title="2"><span class="co">#        states=rep(1,numAgents))</span></a>
<a class="sourceLine" id="cb29-3" title="3"></a>
<a class="sourceLine" id="cb29-4" title="4"></a>
<a class="sourceLine" id="cb29-5" title="5">numDays &lt;-<span class="st"> </span><span class="dv">56</span></a>
<a class="sourceLine" id="cb29-6" title="6"></a>
<a class="sourceLine" id="cb29-7" title="7">naturalImmunity &lt;-<span class="st"> </span><span class="fl">.01</span>  </a>
<a class="sourceLine" id="cb29-8" title="8"></a>
<a class="sourceLine" id="cb29-9" title="9"></a>
<a class="sourceLine" id="cb29-10" title="10">numInteractions &lt;-<span class="st">  </span><span class="kw">rep</span>(<span class="dv">10</span>,numDays)  <span class="co">##how many interactions per day per agent on average initially?</span></a>
<a class="sourceLine" id="cb29-11" title="11">contagionProb &lt;-<span class="st"> </span><span class="kw">rep</span>(.<span class="dv">05</span>,numDays)    <span class="co">##normal contagian probability after contact</span></a>
<a class="sourceLine" id="cb29-12" title="12">sampleFromNetwork &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="fl">1.0</span>,numDays)  <span class="co">##how likely you are to stick with &#39;your&#39; network</span></a>
<a class="sourceLine" id="cb29-13" title="13"></a>
<a class="sourceLine" id="cb29-14" title="14">numInteractions[<span class="dv">5</span><span class="op">:</span>numDays] &lt;-<span class="st"> </span><span class="dv">5</span>     </a>
<a class="sourceLine" id="cb29-15" title="15">numInteractions[<span class="dv">25</span><span class="op">:</span>numDays] &lt;-<span class="st"> </span><span class="dv">10</span>  </a>
<a class="sourceLine" id="cb29-16" title="16"></a>
<a class="sourceLine" id="cb29-17" title="17">plotNetwork &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb29-18" title="18"><span class="co">#re-use previous network</span></a>
<a class="sourceLine" id="cb29-19" title="19"><span class="co">#socialnetwork &lt;-makeNetwork(numAgents,numsets=1,power=.5)</span></a>
<a class="sourceLine" id="cb29-20" title="20"></a>
<a class="sourceLine" id="cb29-21" title="21"></a>
<a class="sourceLine" id="cb29-22" title="22"><span class="cf">if</span>(plotNetwork)</a>
<a class="sourceLine" id="cb29-23" title="23">{</a>
<a class="sourceLine" id="cb29-24" title="24">    cc &lt;-<span class="kw">mygplot</span>(<span class="dt">coord=</span>coords2,socialnetwork,<span class="kw">rep</span>(<span class="dv">1</span>,<span class="kw">nrow</span>(socialnetwork)),<span class="dt">main=</span><span class="st">&quot;Initial state&quot;</span>)</a>
<a class="sourceLine" id="cb29-25" title="25"></a>
<a class="sourceLine" id="cb29-26" title="26">}</a></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">disthistory &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">ncol=</span><span class="dv">7</span>,<span class="dt">nrow=</span>numDays)</a>
<a class="sourceLine" id="cb30-2" title="2">disthistory.up &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">ncol=</span><span class="dv">7</span>,<span class="dt">nrow=</span>numDays)</a>
<a class="sourceLine" id="cb30-3" title="3"></a>
<a class="sourceLine" id="cb30-4" title="4">pool &lt;-<span class="st"> </span><span class="kw">list</span>()</a>
<a class="sourceLine" id="cb30-5" title="5"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numAgents)</a>
<a class="sourceLine" id="cb30-6" title="6">{</a>
<a class="sourceLine" id="cb30-7" title="7">   pool[[i]] &lt;-<span class="st"> </span><span class="kw">makeAgent</span>(<span class="dt">psychstate=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb30-8" title="8">                         <span class="dt">biostate=</span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">6</span>),</a>
<a class="sourceLine" id="cb30-9" title="9">                          <span class="dt">p=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>naturalImmunity, naturalImmunity),<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb30-10" title="10">}</a>
<a class="sourceLine" id="cb30-11" title="11"></a>
<a class="sourceLine" id="cb30-12" title="12"></a>
<a class="sourceLine" id="cb30-13" title="13"><span class="co">##Here we can decide who gets infected first:</span></a>
<a class="sourceLine" id="cb30-14" title="14"><span class="co">##infect patient 0</span></a>
<a class="sourceLine" id="cb30-15" title="15">numInfected &lt;-<span class="st"> </span><span class="dv">5</span> </a>
<a class="sourceLine" id="cb30-16" title="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="kw">sample</span>(numAgents,numInfected))</a>
<a class="sourceLine" id="cb30-17" title="17">{</a>
<a class="sourceLine" id="cb30-18" title="18">   pool[[i]] &lt;-<span class="st"> </span><span class="kw">setAgentState</span>(pool[[i]],<span class="dv">2</span>) <span class="co">##infect this person</span></a>
<a class="sourceLine" id="cb30-19" title="19">}</a>
<a class="sourceLine" id="cb30-20" title="20"></a>
<a class="sourceLine" id="cb30-21" title="21"></a>
<a class="sourceLine" id="cb30-22" title="22"></a>
<a class="sourceLine" id="cb30-23" title="23"><span class="cf">for</span>(day <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numDays)</a>
<a class="sourceLine" id="cb30-24" title="24">{</a>
<a class="sourceLine" id="cb30-25" title="25"><span class="co">##who are you going to talk to today.</span></a>
<a class="sourceLine" id="cb30-26" title="26">    sneezers &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>numAgents,<span class="dt">each=</span>numInteractions[day])</a>
<a class="sourceLine" id="cb30-27" title="27">    sneezedons &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA</span>,<span class="kw">length</span>(sneezers))</a>
<a class="sourceLine" id="cb30-28" title="28">    </a>
<a class="sourceLine" id="cb30-29" title="29">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(sneezers))</a>
<a class="sourceLine" id="cb30-30" title="30">      {</a>
<a class="sourceLine" id="cb30-31" title="31">      <span class="cf">if</span>(<span class="kw">runif</span>(<span class="dv">1</span>)<span class="op">&lt;</span>(<span class="dv">1</span><span class="op">-</span>sampleFromNetwork[day]) )</a>
<a class="sourceLine" id="cb30-32" title="32">      {</a>
<a class="sourceLine" id="cb30-33" title="33">        sneezedons[i] &lt;-<span class="st"> </span><span class="kw">sample</span>(numAgents,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb30-34" title="34">      }<span class="cf">else</span>{</a>
<a class="sourceLine" id="cb30-35" title="35">        sneezedons[i] &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span>numAgents,<span class="dt">prob=</span>socialnetwork[sneezers[i],],<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb30-36" title="36">      }</a>
<a class="sourceLine" id="cb30-37" title="37">     }</a>
<a class="sourceLine" id="cb30-38" title="38">      </a>
<a class="sourceLine" id="cb30-39" title="39">  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(sneezers))</a>
<a class="sourceLine" id="cb30-40" title="40">  {</a>
<a class="sourceLine" id="cb30-41" title="41">    agent1 &lt;-<span class="st"> </span>pool[[ sneezers[i] ]]</a>
<a class="sourceLine" id="cb30-42" title="42">    agent2 &lt;-<span class="st"> </span>pool[[ sneezedons[i] ]]</a>
<a class="sourceLine" id="cb30-43" title="43">  </a>
<a class="sourceLine" id="cb30-44" title="44">    </a>
<a class="sourceLine" id="cb30-45" title="45">    <span class="co">##this constitutes the rules of infection.</span></a>
<a class="sourceLine" id="cb30-46" title="46">    <span class="cf">if</span>((agent1<span class="op">$</span>biostate<span class="op">==</span><span class="dv">2</span> <span class="op">||</span><span class="st"> </span>agent1<span class="op">$</span>biostate<span class="op">==</span><span class="dv">3</span> ) <span class="op">&amp;</span><span class="st"> </span>agent2<span class="op">$</span>biostate<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>)<span class="op">&lt;</span>contagionProb[day])</a>
<a class="sourceLine" id="cb30-47" title="47">    {</a>
<a class="sourceLine" id="cb30-48" title="48">         pool[[ sneezedons[i] ]] &lt;-<span class="st"> </span><span class="kw">setAgentState</span>(agent2,<span class="dv">2</span>)<span class="co">##infect!</span></a>
<a class="sourceLine" id="cb30-49" title="49">    }</a>
<a class="sourceLine" id="cb30-50" title="50">      </a>
<a class="sourceLine" id="cb30-51" title="51">  }</a>
<a class="sourceLine" id="cb30-52" title="52">    <span class="co">##increment each agent 1-day.</span></a>
<a class="sourceLine" id="cb30-53" title="53">    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>numAgents)</a>
<a class="sourceLine" id="cb30-54" title="54">    {</a>
<a class="sourceLine" id="cb30-55" title="55">      pool[[i]] &lt;-<span class="st"> </span><span class="kw">updateAgent</span>(pool[[i]])</a>
<a class="sourceLine" id="cb30-56" title="56">    }</a>
<a class="sourceLine" id="cb30-57" title="57">    </a>
<a class="sourceLine" id="cb30-58" title="58">    states &lt;-<span class="st"> </span><span class="kw">sapply</span>(pool,<span class="dt">FUN=</span><span class="cf">function</span>(x){x<span class="op">$</span>biostate})</a>
<a class="sourceLine" id="cb30-59" title="59">    states.up &lt;-<span class="st"> </span><span class="kw">sapply</span>(pool[inUP],<span class="dt">FUN=</span><span class="cf">function</span>(x){x<span class="op">$</span>biostate})</a>
<a class="sourceLine" id="cb30-60" title="60">    </a>
<a class="sourceLine" id="cb30-61" title="61">    distrib &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">factor</span>(states,<span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</a>
<a class="sourceLine" id="cb30-62" title="62">    distrib.up &lt;-<span class="st"> </span><span class="kw">table</span>(<span class="kw">factor</span>(states.up,<span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">7</span>))</a>
<a class="sourceLine" id="cb30-63" title="63">    </a>
<a class="sourceLine" id="cb30-64" title="64">    disthistory[day,] &lt;-<span class="st"> </span>distrib</a>
<a class="sourceLine" id="cb30-65" title="65">    disthistory.up[day,] &lt;-<span class="st"> </span>distrib.up</a>
<a class="sourceLine" id="cb30-66" title="66"></a>
<a class="sourceLine" id="cb30-67" title="67">       <span class="cf">if</span>(plotNetwork)</a>
<a class="sourceLine" id="cb30-68" title="68">   {</a>
<a class="sourceLine" id="cb30-69" title="69">     <span class="kw">mygplot</span>(cc,socialnetwork,states,<span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Day&quot;</span>,day))</a>
<a class="sourceLine" id="cb30-70" title="70">   }</a>
<a class="sourceLine" id="cb30-71" title="71">  </a>
<a class="sourceLine" id="cb30-72" title="72">         </a>
<a class="sourceLine" id="cb30-73" title="73">  }</a></code></pre></div>
<img src = "support_files/figure-html-michigan/anim2.gif" />
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">  <span class="co">#barplot(t(disthistory),col=1:7)</span></a></code></pre></div>
</div>
<div id="plot-final-state" class="section level2">
<h2>Plot final state</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1"> xx &lt;-<span class="st"> </span><span class="kw">mygplot</span>(cc,socialnetwork,states,<span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Day&quot;</span>,day))</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-7-1.png" width="1440" /></p>
</div>
<div id="progress-in-state-vs.-up-only.-growth-for-up-and-for-entire-state." class="section level2">
<h2>Progress in state vs. UP only. Growth for UP and for entire state.</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">disthist.df &lt;-<span class="kw">as.data.frame</span>(disthistory)</a>
<a class="sourceLine" id="cb33-2" title="2"><span class="kw">colnames</span>(disthist.df) &lt;-<span class="st"> </span>STATENAMES</a>
<a class="sourceLine" id="cb33-3" title="3">disthist.df<span class="op">$</span>day &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(disthistory)</a>
<a class="sourceLine" id="cb33-4" title="4">histlong &lt;-<span class="st"> </span><span class="kw">melt</span>(disthist.df,<span class="dt">id.vars=</span><span class="st">&quot;day&quot;</span>)</a>
<a class="sourceLine" id="cb33-5" title="5"></a>
<a class="sourceLine" id="cb33-6" title="6"><span class="kw">ggplot</span>(histlong,<span class="kw">aes</span>(<span class="dt">x=</span>day,<span class="dt">y=</span>value,<span class="dt">fill=</span>variable)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="dt">position=</span><span class="st">&quot;stack&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb33-7" title="7"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-8-1.png" width="768" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1"><span class="co">##make the SIR plot:</span></a>
<a class="sourceLine" id="cb34-2" title="2">sir &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">day=</span>disthist.df<span class="op">$</span>day,</a>
<a class="sourceLine" id="cb34-3" title="3">                  <span class="dt">susceptible =</span> disthist.df<span class="op">$</span>Unexposed,</a>
<a class="sourceLine" id="cb34-4" title="4">                  <span class="dt">infected =</span> disthist.df[,<span class="dv">2</span>]<span class="op">+</span>disthist.df[,<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb34-5" title="5">                  <span class="dt">recovered =</span> <span class="kw">rowSums</span>(disthist.df[,<span class="dv">4</span><span class="op">:</span><span class="dv">7</span>]))</a>
<a class="sourceLine" id="cb34-6" title="6"></a>
<a class="sourceLine" id="cb34-7" title="7"><span class="kw">ggplot</span>(<span class="kw">melt</span>(sir,<span class="dt">id.vars=</span><span class="st">&quot;day&quot;</span>),<span class="kw">aes</span>(<span class="dt">x=</span>day,<span class="dt">group=</span>variable,<span class="dt">y=</span>value,<span class="dt">color=</span>variable)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()<span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="dt">label=</span><span class="st">&quot;Disease spread in Michigan&quot;</span>)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-8-2.png" width="768" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1"><span class="kw">ggplot</span>(histlong,<span class="kw">aes</span>(<span class="dt">x=</span>day,<span class="dt">y=</span>value,<span class="dt">group=</span>variable,<span class="dt">color=</span>variable)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="dt">label=</span><span class="st">&quot;Disease spread in Michigan&quot;</span>)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-8-3.png" width="768" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1"><span class="co">##Now, do UP only</span></a>
<a class="sourceLine" id="cb36-2" title="2"></a>
<a class="sourceLine" id="cb36-3" title="3">disthist.df &lt;-<span class="kw">as.data.frame</span>(disthistory.up)</a>
<a class="sourceLine" id="cb36-4" title="4"><span class="kw">colnames</span>(disthist.df) &lt;-<span class="st"> </span>STATENAMES</a>
<a class="sourceLine" id="cb36-5" title="5">disthist.df<span class="op">$</span>day &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(disthistory.up)</a>
<a class="sourceLine" id="cb36-6" title="6">histlong &lt;-<span class="st"> </span><span class="kw">melt</span>(disthist.df,<span class="dt">id.vars=</span><span class="st">&quot;day&quot;</span>)</a>
<a class="sourceLine" id="cb36-7" title="7"></a>
<a class="sourceLine" id="cb36-8" title="8"><span class="kw">ggplot</span>(histlong,<span class="kw">aes</span>(<span class="dt">x=</span>day,<span class="dt">y=</span>value,<span class="dt">fill=</span>variable)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>,<span class="dt">position=</span><span class="st">&quot;stack&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb36-9" title="9"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st">  </span><span class="kw">ggtitle</span>(<span class="dt">label=</span><span class="st">&quot;Disease spread in Upper Peninsula Michigan&quot;</span>)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-8-4.png" width="768" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co">##make the SIR plot:</span></a>
<a class="sourceLine" id="cb37-2" title="2">sir &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">day=</span>disthist.df<span class="op">$</span>day,</a>
<a class="sourceLine" id="cb37-3" title="3">                  <span class="dt">susceptible =</span> disthist.df<span class="op">$</span>Unexposed,</a>
<a class="sourceLine" id="cb37-4" title="4">                  <span class="dt">infected =</span> disthist.df[,<span class="dv">2</span>]<span class="op">+</span>disthist.df[,<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb37-5" title="5">                  <span class="dt">recovered =</span> <span class="kw">rowSums</span>(disthist.df[,<span class="dv">4</span><span class="op">:</span><span class="dv">7</span>]))</a>
<a class="sourceLine" id="cb37-6" title="6"></a>
<a class="sourceLine" id="cb37-7" title="7"></a>
<a class="sourceLine" id="cb37-8" title="8"><span class="kw">ggplot</span>(<span class="kw">melt</span>(sir,<span class="dt">id.vars=</span><span class="st">&quot;day&quot;</span>),<span class="kw">aes</span>(<span class="dt">x=</span>day,<span class="dt">group=</span>variable,<span class="dt">y=</span>value,<span class="dt">color=</span>variable)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="dt">label=</span><span class="st">&quot;Disease spread in Upper Peninsula Michigan&quot;</span>)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-8-5.png" width="768" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="kw">ggplot</span>(histlong,<span class="kw">aes</span>(<span class="dt">x=</span>day,<span class="dt">y=</span>value,<span class="dt">group=</span>variable,<span class="dt">color=</span>variable)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()<span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="dt">label=</span><span class="st">&quot;Disease spread in Upper Peninsula Michigan&quot;</span>)</a></code></pre></div>
<p><img src="support_files/figure-html-michigan/unnamed-chunk-8-6.png" width="768" /></p>
<p>##can model each county as an SIR. Can model larger numagents, but it takes forever to run.</p>
</div>
</div>


</div>




<script>
$(document).ready(function () {
 	  });
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
